<!DOCTYPE html>
<html>

<head>
    <title>综合能耗监测</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" id='theme' href="css/theme-dark-blue.css" />
</head>

<body id="onlineEnergyMonitor">
    <div class="page-container">
        <a href="# " class="x-navigation-minimize menu_minimalize"><span class="arrow arrow-shrink "></span></a>
        <div class="page-sidebar page-sidebar-fixed scroll">
            <ul id='menu' class="x-navigation">
                <li class="xn-logo">
                    <a href="index.html"></a>
                    <a href='#' class="x-navigation-control "></a>
                </li>
            </ul>
        </div>
        <div class="page-content ">
            <h3 class="page-title">
                <ul class="x-navigation x-navigation-horizontal log-out pull-right">
                    <li class="xn-icon-button last ">
                        <a href="# "><span class="fa fa-power-off "></span></a>
                        <ul class="xn-drop-left animated zoomIn ">
                            <li><a href="# " class="mb-control " data-box="#mb-signout "><span class="fa fa-sign-out "></span> 登出</a></li>
                        </ul>
                    </li>
                </ul>
                综合能耗监测</h3>
            <div class="page-content-wrap chart_container">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-xl-2 col-lg-4 col-md-6 col-sm-6">
                            <div class="wigit-title yellow-bg"></div>
                            <div class="iPanel wigit-panel">
                                <!-- 今日综合能源消费量 -->
                                <p class="wigit-text wigit-text1"></p>
                                <p class="wigit-value"><span id="el_energy" class="value"></span><span id="el_energy_title"></span></p>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-4 col-md-6 col-sm-6">
                            <div class="wigit-title green-bg"></div>
                            <div class="iPanel wigit-panel">
                                <!-- 今日全市用电总量 -->
                                <p class="wigit-text wigit-text2"></p>
                                <p class="wigit-value"><span id="el_power" class="value"></span><span id="el_power_title"></span></p>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-4 col-md-6 col-sm-6">
                            <div class="wigit-title cyan-bg"></div>
                            <div class="iPanel wigit-panel">
                                <!-- 今日全市用水总量 -->
                                <p class="wigit-text wigit-text3"></p>
                                <p class="wigit-value"><span id="el_water" class="value"></span><span id="el_water_title"></span></p>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-4 col-md-6 col-sm-6">
                            <div class="wigit-title blue-bg"></div>
                            <div class="iPanel wigit-panel">
                                <!-- 今日全市蒸汽总量 -->
                                <p class="wigit-text wigit-text4"></p>
                                <p class="wigit-value"><span id="el_steam" class="value"></span><span id="el_steam_title"></span></p>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-4 col-md-6 col-sm-6">
                            <div class="wigit-title purple-bg"></div>
                            <div class="iPanel wigit-panel">
                                <!-- 今日全市天然气总量 -->
                                <p class="wigit-text wigit-text5"></p>
                                <p class="wigit-value"><span id="el_gas" class="value"></span><span id="el_gas_title"></span></p>
                            </div>
                        </div>
                        <div class="col-xl-2 col-lg-4 col-md-6 col-sm-6">
                            <div class="wigit-title red-bg"></div>
                            <div class="iPanel wigit-panel">
                                <!-- 全市接入企业 -->
                                <p class="wigit-text wigit-text6"></p>
                                <p class="wigit-value"><span id="el_enterpriseSize" class="value"></span><span title="家">家</span></p>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="panel_title">
                                <div class="col-sm-4">
                                    <h4>能源趋势图</h4>
                                </div>
                                <div class="col-sm-8 clearfix">
                                    <div class="gap-btn-group pull-right bar-group" role="group">
                                        <div class="btn-group mr12">
                                            <button id="today" type="button" title="搜索" class="btn btn-outline btn-link active">
                                                <span>今日</span>
                                            </button>
                                            <button id="thismonth" type="button" title="搜索" class="btn btn-outline btn-link">
                                                <span>本月</span>
                                            </button>
                                        </div>
                                        <div class="btn-group" role="group">
                                            <select id="enengyType" class="form-control select iselect w180" name="isCapital"></select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="iPanel">
                                <div class="content">
                                    <h4 id="chart_title" class="title">能耗分布图</h4>
                                    <div class="chart-wrap">
                                        <div id="line_bar"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="panel_title" style="border-bottom: none;">
                                <div class="col-sm-4">
                                    <h4>本月综合能耗排名</h4>
                                </div>
                            </div>
                            <div class="iPanel single_table_panel">
                                <div class="content">
                                    <table id="TContact" data-height="559" data-mobile-responsive="true">
                                        <thead>
                                            <tr class="hidden-em">
                                                <th data-formatter="IndexFormatter">排名</th>
                                                <th data-field="name">企业名称</th>
                                                <th data-field="energy_total" data-align="right">综合能耗<span class="st">(吨标准煤)</span></th>
                                                <th data-field="power_total" data-align="right">用电总量<span class="st">(千瓦时)</span></th>
                                                <th data-field="water_total" data-align="right">用水总量<span class="st">(吨)</span></th>
                                                <th data-field="gas_total" data-align="right">蒸汽总量<span class="st">(万千焦耳)</span></th>
                                                <th data-field="steam_total" data-align="right">天然气总量<span class="st">(立方米)</span></th>
                                            </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="message-box animated fadeIn" data-sound="alert " id='mb-signout'>
        <div class="mb-container ">
            <div class="mb-middle ">
                <div class="mb-title"><span class="fa fa-sign-out "></span> Log <strong>Out</strong> ?</div>
                <div class="mb-content ">
                    <p>确定登出?</p>
                    <p>如果您想继续留在此页面，请点击"否"</p>
                </div>
                <div class="mb-footer ">
                    <div class="pull-right ">
                        <a href="login.html " class="btn btn-success btn-lg ">是</a>
                        <button class="btn btn-default btn-lg mb-control-close ">否</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>
<script type='text/javascript' src="js/import.js"></script>
<script type='text/javascript' src="js/pages/common.js"></script>
<script type='text/javascript' src="js/pages/CURDTable.js"></script>
<script type='text/javascript' src="js/charts/echart_yarn.min.js"></script>
<script>
    var __current_energy_type;
    var __current_date_type = 'today';

    function setActive(el) {
        $(el).addClass('active').siblings('button').removeClass('active');
    }

    function initPage() {
        initSelectByUrl('enengyType', '/energy/enengyType/getEnergyTypeList?key=enengyType', function() {
            getDayLine($('#enengyType').val());
        });
        getOverView();
        new cur({
            t: "#TContact",
            m: "#modal",
            footerbar: '#footerbar',
            showAfterRender: ['#footerbar'],
            queryUrl: "/energy/monitorInfo/getEnergyList"
        }).init();
    }

    function getOverView() {
        eBase.send({
            url: '/energy/monitorInfo/general'
        }, 'get').done(function(resp) {
            var data = resp.rows;

            if ('0' == resp['code']) {
                var obj = resp['data'];
                for (var key in obj) {
                    $('#el_' + key).text(obj[key]);
                    $('#el_' + key).attr('title', obj[key]);
                }
            }

        }).fail(function() {
            console.log('获取数据失败');
        });
    }

    function getDayLine(type) {
        $('#chart_title').text('日用能趋势');
        setActive($('#today'));

        new yarn({
            charts: [{
                el: 'line_bar',
                type: 'line',
                url: '/energy/monitorInfo/hour/online/' + type,
                theme_obj: {
                    areaStyle: ['rgba(24, 144, 255, 0.20)', 'rgba(46, 194, 91, 0.20)']
                },
                scale: 0.20,
                min_height: 300,
                max_height: 600
            }]
        }).init();
    }

    function getMonthLine(type) {
        setActive($('#thismonth'));
        $('#chart_title').text('月用能趋势');
        new yarn({
            charts: [{
                el: 'line_bar',
                type: 'line',
                url: '/energy/monitorInfo/date/online/' + type,
                theme_obj: {
                    areaStyle: ['rgba(24, 144, 255, 0.20)', 'rgba(46, 194, 91, 0.20)']
                },
                scale: 0.20,
                min_height: 300,
                max_height: 600
            }]
        }).init();
    }

    $('#today').click(function() {
        __current_date_type = 'today';
        getDayLine($('#enengyType').val());
    });

    $('#thismonth').click(function() {
        __current_date_type = 'month';
        getMonthLine($('#enengyType').val());
    });

    $('#enengyType').change(function() {
        switch (__current_date_type) {
            case 'month':
                getMonthLine($('#enengyType').val());
                break;
            case 'day':
            default:
                getDayLine($('#enengyType').val());
                break;
        }
    });

    initPage();
</script>

</html>