<!DOCTYPE html>
<html>

<head>
    <title>执法过程管理</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="favicon.ico" type="image/x-icon" />
    <link rel="stylesheet" type="text/css" id='theme' href="css/theme-dark-blue.css" />
</head>

<body>
    <div class="page-container">
        <a href="# " class="x-navigation-minimize menu_minimalize"><span class="arrow arrow-shrink "></span></a>
        <div class="page-sidebar page-sidebar-fixed scroll">
            <ul id='menu' class="x-navigation">
                <li class="xn-logo">
                    <a href="index.html"></a>
                    <a href='#' class="x-navigation-control "></a>
                </li>
            </ul>
        </div>
        <div class="page-content ">
            <h3 class="page-title">
                <ul class="x-navigation x-navigation-horizontal log-out pull-right">
                    <li class="xn-icon-button last ">
                        <a href="# "><span class="fa fa-power-off "></span></a>
                        <ul class="xn-drop-left animated zoomIn ">
                            <li><a href="# " class="mb-control " data-box="#mb-signout "><span class="fa fa-sign-out "></span> 登出</a></li>
                        </ul>
                    </li>
                </ul>
            执法过程管理</h3>
            <div class="page-content-wrap">
                <div class="page-content-box mb24">
                    <div class="panel_title">
                        <div class="col-md-3 col-sm-6 col-xs-6">
                            <h4>节能监察项目概览</h4>
                        </div>
                        <div class="col-md-9 col-sm-6  col-xs-6">
                            <div class="gap-btn-group pull-right bar-group" role="group">
                                <div class="btn-group">
                                    <input id="date_input" type="text" name="name" class="form-control laydate-icon layer-date w140">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row monitor_kuang">
                        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 item relative">
                            <div class="iPanel monitor_panel">
                                <p class="dashboard-text">监察总数</p>
                                <p class="dashboard-box" id="process1">
                                    <span class="dashboard-value"></span>
                                    <span>个</span>
                                </p>
                            </div>
                            <div class="dashboard-icon icon1"></div>
                        </div>
                        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 item relative">
                            <div class="iPanel monitor_panel">
                                <p class="dashboard-text">现场监察</p>
                                <p class="dashboard-box" id="process2">
                                    <span class="dashboard-value"></span>
                                    <span>个</span>
                                </p>
                            </div>
                            <div class="dashboard-icon icon2"></div>
                        </div>
                        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 item relative">
                            <div class="iPanel monitor_panel">
                                <p class="dashboard-text">整改中</p>
                                <p class="dashboard-box" id="process3">
                                    <span class="dashboard-value"></span>
                                    <span>个</span>
                                </p>
                            </div>
                            <div class="dashboard-icon icon3"></div>
                        </div>
                        <div class="col-xl-3 col-lg-6 col-md-6 col-sm-6 item relative">
                            <div class="iPanel monitor_panel">
                                <p class="dashboard-text">已结案</p>
                                <p class="dashboard-box" id="process4">
                                    <span class="dashboard-value"></span>
                                    <span>个</span>
                                </p>
                            </div>
                            <div class="dashboard-icon icon4"></div>
                        </div>
                    </div>
                    <div class="row monitor_kuang01">
                        <div class="col-xl-6 col-lg-6 item">
                            <div class="iPanel">
                                <div class="content clearfix">
                                    <div class="col-xs-12">
                                        <div class="chart-wrap">
                                            <div id="line"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-xl-6 col-lg-6 item">
                            <div class="iPanel">
                                <div class="content clearfix">
                                    <div class="col-xs-12">
                                        <div class="chart-wrap">
                                            <div id="bar"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="page-content-box gap24">
                    <div class="clearfix mytbar">
                        <div class="btn-group pull-right" role="group">
                            <button id="add" type="button" title="新增客户" class="btn btn-outline btn-primary pull-right">
                                <span>新增</span>
                            </button>
                        </div>
                    </div>
                    <div class="content">
                        <table id="TContact" data-height="559" data-mobile-responsive="true"></table>
                        <div id="footerbar" class="footerbar hidden-em">
                            <div class="gap-btn-group" role="group">
                                <button id="checkall" type="button" class="btn btn-outline btn-default" data-cked="unchecked">
                                    <span>全选</span>
                                </button>
                                <button id="bedit" type="button" class="btn btn-outline btn-primary">
                                    <span>批量操作</span>
                                </button>
                                <button id="bdel" type="button" title="删除客户" class="btn btn-outline btn-primary">
                                    <span>删除</span>
                                </button>
                                <button id="endState" type="button" title="删除客户" class="btn btn-outline btn-primary">
                                    <span>完成</span>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    </div>
    <div class="message-box animated fadeIn" data-sound="alert " id='mb-signout'>
        <div class="mb-container ">
            <div class="mb-middle ">
                <div class="mb-title"><span class="fa fa-sign-out "></span> Log <strong>Out</strong> ?</div>
                <div class="mb-content ">
                    <p>确定登出?</p>
                    <p>如果您想继续留在此页面，请点击"否"</p>
                </div>
                <div class="mb-footer ">
                    <div class="pull-right ">
                        <a href="login.html " class="btn btn-success btn-lg ">是</a>
                        <button class="btn btn-default btn-lg mb-control-close ">否</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="modal" class="modal fade">
        <div class="modal-dialog">
            <form action="javascript:void(0)" data-bv-message="验证未通过" data-bv-feedbackicons-valid="glyphicon glyphicon-ok" data-bv-feedbackicons-invalid="glyphicon glyphicon-remove" data-bv-feedbackicons-validating="glyphicon glyphicon-refresh">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                        <h4 class="modal-title"></h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group hidden-em">
                            <label>id</label>
                            <input type="text" class="form-control" name="id">
                        </div>
                        <div class="form-group">
                            <label><span class="text-red">*</span>任务名称 </label>
                            <input type="text" class="form-control" name="task_name" required>
                        </div>
                        <div class="form-group">
                            <label><span class="text-red">*</span>被监察企业</label>
                            <select id="monitor_enterprise" class="form-control" name="monitor_enterprise_id" required></select>
                        </div>
                        <div class="form-group">
                            <label>地址</label>
                            <input type="text" class="form-control" name="address">
                        </div>
                        <div class="form-group">
                            <label>联系人 </label>
                            <input type="text" class="form-control" name="contacts">
                        </div>
                        <div class="form-group">
                            <label>电话</label>
                            <input type="text" class="form-control" name="phone">
                        </div>
                        <div class="form-group">
                            <label>传真</label>
                            <input type="text" class="form-control" name="fax">
                        </div>
                        <div class="form-group">
                            <label>监察日期 </label>
                            <input id="monitor_date" type="text" name="monitor_date1" class="form-control laydate-icon layer-date">
                        </div>
                        <div class="form-group">
                            <label>节能监察人员 </label>
                            <input type="text" class="form-control" name="monitor_person">
                        </div>
                        <div class="form-group">
                            <label>监察内容 </label>
                            <input type="text" class="form-control" name="monitor_content">
                        </div>
                        <div class="form-group">
                            <label>监察方式 </label>
                            <input type="text" class="form-control" name="monitor_way">
                        </div>
                        <!-- <div class="form-group">
                            <label><span class="text-red">*</span>任务状态 </label>
                            <select id="task_status" class="form-control" name="task_status" required></select>
                        </div> -->
                        <div class="form-group">
                            <label>附件上传 </label>
                            <input type="file" class="file" id="file" data-field="file" />
                            <input type="hidden" name="file" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default cancel" data-dismiss="modal">取&nbsp;&nbsp;消</button>
                        <button type="button" class="btn btn-primary submit">保&nbsp;&nbsp;存</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</body>
<script type='text/javascript' src="js/import.js"></script>
<script type='text/javascript' src="js/pages/common.js"></script>
<script type='text/javascript' src="js/pages/CURDTable.js"></script>
<script type='text/javascript' src="js/charts/echart_yarn.min.js"></script>
<script>
initDateInputForYear('#date_input',chooseFun);
$('#date_input').val(getThisYear());

function OperatingFomatterT(value, row, index) {
    var uuid = 'id';
    return '<span class="operate"><a href="javascript:void(0);" class="tdetail" onclick="taskFlow(' + row[uuid] + ','+ '\'' + row['name'] + '\'' +')">任务流</a>\
        |<a href="javascript:void(0);" class="tdel" onclick="onDelClick(' + row[uuid] + ')">删除</a></span>';
}

function taskFlow(id, name) {
    window.location = 'taskFlow.html?enterpriseId=' + id + '&name=' + name 
}

function chooseFun(v){
    getCharts(v);
}

function getCharts(year){
    eBase.send({
        "url": '/monitor/lawEnfor/getCounts/' + year
    }, "get").done(function(res) {
        $('#process1').find('.dashboard-value').text(res.data.projSum);
        $('#process2').find('.dashboard-value').text(res.data.supervisionProjCounts);
        $('#process3').find('.dashboard-value').text(res.data.improvingProjCounts);
        $('#process4').find('.dashboard-value').text(res.data.doneProjCounts);
    })

    new yarn({
        charts: [{
            el: 'line',
            type: 'line',
            theme: 'dashboard_line',
            url: '/monitor/lawEnfor/chart/getByStatus/' + year,
            theme_obj: { areaStyle: ['rgba(255,187,68,0.2)'], legend: { left: 80 } },
            h: 279
        }]
    }).init();

    new yarn({
        charts: [{
            el: 'bar',
            type: 'bar',
            theme: 'dashboard_bar2',
            url: '/monitor/lawEnfor/chart/getBydistrict/' + year,
            theme_obj: {
                barWidth: '25%',
                legend: { left: 80 }
            },
            h: 279
        }]
    }).init();
}

function initPage() {

    getCharts($('#date_input').val());

    var c = new cur({
            t: "#TContact",
            m: "#modal",
            addBtn: "#add",
            serBtn: "#ser",
            footerbar: '#footerbar',
            showAfterRender: ['#footerbar'],
            dataInputs: ["#monitor_date"],
            childSls: {
                "#monitor_enterprise": {
                    def: '--请选择企业--',
                    url: '/energy/enterprise/getNameList?key=monitor_enterprise',
                    type: 'GET'
                },
            //     "#task_status": {
            //         def: '--请选择任务状态--',
            //         url: '/energy/sys/getList?key=task_status&code=000160001',
            //         autoRef: 'true',
            //         type: 'GET'
            //     },
            },
            pageSize: 11,
            height: 740,
            uuid: "id",
            hideCols: ['id'],
            search_params: {
                field_select: '#field_select',
                field_input: '#search_input'
            },
            inputBar: "#inputBox",
            queryUrl: "/monitor/lawEnfor/getList",
            addUrl: "/monitor/lawEnfor/add",
            editUrl: "/monitor/lawEnfor/edit",
            delUrl: "/monitor/lawEnfor/del",
            columns: [{
                field: 'state',
                align: "center",
                valign: "middle",
                checkbox:'true'
            },{
                field: 'index',
                align: "left",
                valign: "middle",
                title: '序号',
                formatter: function(value, row, index) {
                    var options = $('#TContact').bootstrapTable("getOptions");
                    return (options.pageNumber - 1) * (options.pageSize) + index + 1;
                }
            }, {
                title: '任务名称',
                align: "left",
                valign: "middle",
                field: 'task_name'
            }, {
                title: '监察方式',
                align: "center",
                valign: "middle",
                field: 'monitor_way',
            }, {
                title: '被监察企业',
                align: "left",
                valign: "middle",
                field: 'name'
            }, {
                title: '监察日期',
                align: "center",
                valign: "middle",
                field: 'monitor_date1',
                formatter:DateFormatter
            }, {
                title: '任务状态',
                align: "left",
                valign: "middle",
                field: 'status_name'
            }, {
                title: '操作',
                align: "right",
                valign: "middle",
                field: 'operate',
                formatter: OperatingFomatterT
            }]
        });
        c.init(c);

        c.on('modify.complete', function() {
            getCharts($('#date_input').val());
        });

}

initPage();
</script>
</html>